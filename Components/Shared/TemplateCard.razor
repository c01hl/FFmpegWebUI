@using FFmpegWebUI.Models

@if (ViewMode == "list")
{
    <div class="template-card-list @(IsSelected ? "selected" : "")">
        <div class="list-main">
            <div class="list-header">
                <span class="card-name">@Template.Name</span>
                <div class="card-badges">
                    @if (Template.Type == TemplateType.System)
                    {
                        <span class="badge system">é¢„è®¾</span>
                    }
                    else
                    {
                        <span class="badge user">è‡ªå®šä¹‰</span>
                    }
                    @if (Template.RequiresHardwareAcceleration)
                    {
                        <span class="badge hw">ğŸš€</span>
                    }
                </div>
            </div>
            <p class="card-desc">@Template.Description</p>
            <div class="list-command">
                <div class="command-header-row">
                    <span class="command-label">FFmpeg å‘½ä»¤å‚æ•°:</span>
                    <button class="copy-btn-small @(_copied ? "copied" : "")" @onclick="CopyCommand" @onclick:stopPropagation="true" title="å¤åˆ¶å‘½ä»¤">
                        @(_copied ? "âœ“" : "ğŸ“‹")
                    </button>
                </div>
                <code class="command-code">@Template.CommandArgs</code>
            </div>
            <div class="card-meta">
                <span>ğŸ“ .@Template.OutputExtension</span>
                <span>ğŸ“‚ @Template.Category</span>
            </div>
        </div>
        <div class="list-actions">
            <button class="btn-icon" title="æŸ¥çœ‹è¯¦æƒ…" @onclick="OnViewClick">
                ğŸ”
            </button>
            @if (Template.Type == TemplateType.System)
            {
                <button class="btn-icon copy" title="å¤åˆ¶æ¨¡æ¿" @onclick="OnCopyClick">
                    ğŸ“‹
                </button>
            }
            else
            {
                <button class="btn-icon" title="ç¼–è¾‘" @onclick="OnEditClick">
                    âœï¸
                </button>
                <button class="btn-icon delete" title="åˆ é™¤" @onclick="OnDeleteClick">
                    ğŸ—‘ï¸
                </button>
            }
            <button class="btn-use" @onclick="OnSelectClick">
                é€‰æ‹©
            </button>
        </div>
    </div>
}
else
{
    <div class="template-card @(IsSelected ? "selected" : "")">
        <div class="card-header">
            <span class="card-name">@Template.Name</span>
            <div class="card-badges">
                @if (Template.Type == TemplateType.System)
                {
                    <span class="badge system">é¢„è®¾</span>
                }
                else
                {
                    <span class="badge user">è‡ªå®šä¹‰</span>
                }
                @if (Template.RequiresHardwareAcceleration)
                {
                    <span class="badge hw">ğŸš€</span>
                }
            </div>
        </div>

        <p class="card-desc">@Template.Description</p>

        <div class="card-meta">
            <span>ğŸ“ .@Template.OutputExtension</span>
            <span>ğŸ“‚ @Template.Category</span>
        </div>

        <div class="card-actions">
            <button class="btn-icon" title="æŸ¥çœ‹è¯¦æƒ…" @onclick="OnViewClick">
                ğŸ”
            </button>
            @if (Template.Type == TemplateType.System)
            {
                <button class="btn-icon copy" title="å¤åˆ¶æ¨¡æ¿" @onclick="OnCopyClick">
                    ğŸ“‹
                </button>
            }
            else
            {
                <button class="btn-icon" title="ç¼–è¾‘" @onclick="OnEditClick">
                    âœï¸
                </button>
                <button class="btn-icon delete" title="åˆ é™¤" @onclick="OnDeleteClick">
                    ğŸ—‘ï¸
                </button>
            }
            <button class="btn-use" @onclick="OnSelectClick">
                é€‰æ‹©
            </button>
        </div>
    </div>
}

@code {
    [Parameter, EditorRequired]
    public CommandTemplate Template { get; set; } = default!;

    [Parameter]
    public string ViewMode { get; set; } = "grid";

    [Parameter]
    public bool IsSelected { get; set; }

    [Parameter]
    public EventCallback<CommandTemplate> OnSelect { get; set; }

    [Parameter]
    public EventCallback<CommandTemplate> OnEdit { get; set; }

    [Parameter]
    public EventCallback<CommandTemplate> OnDelete { get; set; }

    [Parameter]
    public EventCallback<CommandTemplate> OnView { get; set; }

    [Parameter]
    public EventCallback<CommandTemplate> OnCopy { get; set; }

    private bool _copied;

    private async Task CopyCommand()
    {
        _copied = true;
        StateHasChanged();
        await Task.Delay(2000);
        _copied = false;
        StateHasChanged();
    }

    private async Task OnSelectClick()
    {
        await OnSelect.InvokeAsync(Template);
    }

    private async Task OnEditClick()
    {
        await OnEdit.InvokeAsync(Template);
    }

    private async Task OnDeleteClick()
    {
        await OnDelete.InvokeAsync(Template);
    }

    private async Task OnViewClick()
    {
        await OnView.InvokeAsync(Template);
    }

    private async Task OnCopyClick()
    {
        await OnCopy.InvokeAsync(Template);
    }
}

<style>
    /* ç½‘æ ¼æ¨¡å¼å¡ç‰‡æ ·å¼ */
    .template-card {
        background: var(--card-bg, white);
        border: 1px solid var(--border-color, #ddd);
        border-radius: 8px;
        padding: 1rem;
        transition: box-shadow 0.2s, border-color 0.2s;
        color: var(--text-primary, #333);
    }

    .template-card:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .template-card.selected {
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    /* åˆ—è¡¨æ¨¡å¼å¡ç‰‡æ ·å¼ */
    .template-card-list {
        background: var(--card-bg, white);
        border: 1px solid var(--border-color, #ddd);
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        gap: 1rem;
        transition: box-shadow 0.2s, border-color 0.2s;
        color: var(--text-primary, #333);
    }

    .template-card-list:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .template-card-list.selected {
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    .list-main {
        flex: 1;
        min-width: 0;
    }

    .list-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.35rem;
    }

    .list-command {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        margin: 0.5rem 0;
        padding: 0.5rem 0.75rem;
        background: var(--input-bg, #f5f5f5);
        border-radius: 4px;
        border: 1px solid var(--border-color, #eee);
    }

    .command-header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .command-label {
        font-size: 0.75rem;
        color: var(--text-secondary, #666);
        white-space: nowrap;
        flex-shrink: 0;
    }

    .copy-btn-small {
        padding: 0.15rem 0.4rem;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 3px;
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.2s;
        line-height: 1;
    }

    .copy-btn-small:hover {
        background: #0056b3;
    }

    .copy-btn-small.copied {
        background: #28a745;
    }

    .command-code {
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.8rem;
        color: var(--text-primary, #333);
        word-break: break-all;
        line-height: 1.4;
    }

    .list-actions {
        display: flex;
        flex-direction: row;
        gap: 0.35rem;
        align-items: center;
        justify-content: flex-end;
        flex-shrink: 0;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .card-name {
        font-weight: 600;
        font-size: 1rem;
        color: var(--text-primary, #333);
    }

    .card-badges {
        display: flex;
        gap: 0.25rem;
    }

    .badge {
        padding: 0.1rem 0.4rem;
        border-radius: 3px;
        font-size: 0.7rem;
    }

    .badge.system {
        background: #e9ecef;
        color: #495057;
    }

    .badge.user {
        background: #d4edda;
        color: #155724;
    }

    .badge.hw {
        background: #cce5ff;
        color: #004085;
    }

    .card-desc {
        margin: 0 0 0.75rem 0;
        font-size: 0.85rem;
        color: var(--text-secondary, #666);
        line-height: 1.4;
    }

    .card-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.8rem;
        color: var(--text-muted, #888);
        margin-bottom: 0.75rem;
    }

    .card-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
        align-items: center;
    }

    .btn-icon {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.25rem;
        font-size: 1rem;
        opacity: 0.6;
        transition: opacity 0.2s;
    }

    .btn-icon:hover {
        opacity: 1;
    }

    .btn-icon.delete:hover {
        opacity: 1;
        color: #dc3545;
    }

    .btn-icon.copy:hover {
        opacity: 1;
        color: #28a745;
    }

    .btn-use {
        padding: 0.4rem 0.8rem;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 0.85rem;
        cursor: pointer;
    }

    .btn-use:hover {
        background: #0056b3;
    }
</style>
